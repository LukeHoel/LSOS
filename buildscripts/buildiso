#set up colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color

#Make build directory, if not present
cd ..
mkdir build

#Build Assembly bootstrapper
cd buildfiles
nasm -f elf32 boot.asm -o ../build/boot.o
cd ..

if [ $? -eq 0 ]; then
    echo -e "${GREEN}Assembly bootstrapper OK${NC}"
else
    echo -e "${RED}Assembly bootstrapper FAILED${NC}"
    exit 1
fi

#Build high level kernel (c++)
buildscripts/buildcfiles

if [ $? -ne 0 ]; then
    exit 1
fi

#Build linker
i686-elf-gcc -T buildfiles/link.ld -o myos.bin -ffreestanding -O2 -nostdlib build/boot.o build/kernel.o -lgcc


if [ $? -eq 0 ]; then
    echo -e "${GREEN}Linker OK${NC}"
else
    echo -e "${RED}Linker FAILED${NC}"
    exit 1
fi
